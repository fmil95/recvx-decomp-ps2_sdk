[SCEI CONFIDENTIAL DOCUMENT]
"PlayStation 2" Programmer Tool Runtime Library  Release 2.0
                  Copyright (C) 1999 by Sony Computer Entertainment Inc.
                                                     All Rights Reserved

VU1を用いたパーティクル描画サンプル

<サンプルの解説>
        VU1で与えられた３次元座標からパーティクルにモーションブラーを
        つけて描画するサンプルプログラムです。
        描画するサンプルには花火(blow)と煙(gas)があり、両方とも
        全く同一のマイクロコードを用いて描画しています。

<ファイル>
        blow.c          ：メインプログラム
        blow.h          ：花火用のパーティクルの設定パラメータ
        data.dsm        ：花火用のパーティクル、パーティクルの照り返しのデータ
                          パケット
        data_gas.dsm    ：煙用のパーティクル、パーティクルの照り返しのデータ
                          パケット
        draw.vsm        ：地面を描画するためのマイクロコード
        firebit.dsm     ：パーティクルのテクスチャ
        fireref.dsm     ：パーティクルの照り返しのテクスチャ
        gas.h           ：煙用のパーティクルの設定パラメータ
        gas_tex.dsm     ：煙のテクスチャ
        grid.dsm        ：地面のデータパケット
        p.vsm           ：パーティクルを描画するためのマイクロコード
        p_opt.vsm       ：p.vsmを最適化したもの
        p2.vsm          ：パーティクルの照り返しを描画するためのマイクロコード
        part.dat        ：パーティクルのデータ列
        part1.dsm       ：part.datをVIFtagで括ったもの
        part10.dsm      ：part1.dsmを１０個まとめたもの
        physics.c       ：パーティクルの軌跡を計算する関数
        spart.dat       ：パーティクル照り返しのデータ列
        spart1.dsm      ：spart.datをVIFtagで括ったもの
        spart10.dsm     ：spart1.dsmを１０個まとめたもの
        src.dsm         ：パーティクルの速度ベクトル、色の保存用エリア
        srcpart.dat     ：src.dsmにインクルードされるデータ列
        wood.dsm        ：地面のテクスチャ

<起動方法>

        % make          ：花火サンプルのコンパイル
        % make run      ：花火サンプルの実行

        % make -f Makefile.gas          ：煙サンプルのコンパイル
        % make -f Makefile.gas run      ：煙サンプルの実行

        コンパイル後、以下の方法でも実行可能
        % dsedb
        > run blow.elf

<コントローラの操作方法>
        方向キー        ：視点の移動
        ○ボタン        ：パーティクルの停止

<備考>
        処理の概略は、以下の通りです。

        [blow.c]
        1. ダブルバッファの設定、テクスチャのロード
        2. パラメータ、パーティクルの初期化
        3. 透視変換マトリクス、視線に垂直なオフセットベクトル
           （パーティクル展開用）をパケット中にセット
        4. 地面を描画
        5. パーティクルとパーティクルの照り返しの座標を計算
           (SetParticlePosition、花火用と煙用にそれぞれ準備)
        6. パーティクルの照り返しを描画
        7. パーティクルを描画
        8. 3に戻る

        VU1マイクロの中では以下のような処理を行っています。

        [draw.vsm]
        1. 回転 x 透視変換マトリクスを設定
        2. 各種パラメータ（マトリクス等）をVU1レジスタにロード
        3. 法線ベクトル、頂点座標、ST値、色をロード
        4. 透視変換、光源計算をして結果をVU1Memにストア
        5. 3. に戻り、頂点数回繰り返し
        6. ストアされたデータ(Gif Packet)をGSへXGKICK

        [p.vsm]
        1. 各種パラメータ（オフセット、透視変換マトリクス等、ST）を
           VU1レジスタにロード
        2. 座標、速度ベクトル、色をロード
        3. 速度ベクトルによって座標を移動（モーションブラーのため）
        4. 3.で得られた座標とオフセットを加えた座標の２点を透視変換
        5. 4.の２点を結ぶ線分を対角線とする四角形（４点による
           トライアングルストリップ）を作成
        6. 5.の結果、対応するST、色をVU1Memにストア
        7. 2.へ戻り、パーティクル数繰り返し
        8. ストアされたデータ(Gif Packet)をGSへXGKICK

        [p2.vsm]
        p.vsmよりモーションブラーを取り除いたものとなります。VU1Mem上での
        ダブルバッファリングも行っています。
    
        注意
        p2.vsmは最適化されておりません。



