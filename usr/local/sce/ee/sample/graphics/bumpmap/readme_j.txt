[SCEI CONFIDENTIAL DOCUMENT]
"PlayStation 2" Programmer Tool Runtime Library  Release 2.0
                  Copyright (C) 1999 by Sony Computer Entertainment Inc.
                                                     All Rights Reserved

バンプマッピングサンプル

<サンプルの解説>
       擬似バンプマッピング描画を行うサンプル

<ファイル>
        grid.dsm        : グリッドのモデルパケット
        m.vsm           : stに与えられたオフセットを与えて計算するマイクロ                           コード
        m_opt.vsm       : m.vsmの最適化版
        main.c          : メイン
        mat.dsm         : マットの柄のテクスチャデータ
        packet.dsm      : 透視変換マトリクスやGSの設定のためのパケット
        textbump.dsm    : 文字"BUMP MAP"のバンプテクスチャ
        wavebump.dsm    : 波の柄のバンプテクスチャ

<起動方法>

        % make          ：バンプマップサンプルのコンパイル
        % make run      ：バンプマップサンプルの実行

        コンパイル後、以下の方法でも実行可能

        % dsedb
        > run main.elf

<コントローラの操作方法>
        方向キー        : 視点の移動
        ○□ボタン      : ライトの方向の変化
        STARTボタン     : バンプのON/OFF
        SELECTボタン    : バンプテクスチャの切り替え

<備考>
        このサンプルでのバンプマッピングの処理は以下のようになります。

        1. 元のモデルを図柄のテクスチャ付きで描画する。
        2. 描画されたフレームバッファからバンプテクスチャ付きで
           同じモデルを描画し、フレームバッファの色から引く。
           このとき、モデルのテクスチャ座標stを、光源の方向に
           元々のものから少しずらす。
        3. stをずらさずに、バンプテクスチャ付きのモデルを描画する。
           今度はフレームバッファに色を加える。

        2, 3でstの値がずれた分だけ元の図柄に濃淡が現れ、これによって
        バンプのような効果を得ることができます。

<処理概略>
        処理の概略は、以下の通りです。

        [main.c]
        1. グラフィックスのパラメータのリセット
        2. ダブルバッファの設定
        3. テクスチャのパラメータの設定
        4. マイクロコード、テクスチャのロード
        5. パッドからの入力で各種パラメータ設定
        6. 描画DMAのキック

        VU1マイクロの中では以下のような処理を行っています。

        [m.vsm]
        1. 回転 x 透視変換マトリクスを設定
        2. 各種パラメータ（マトリクス等）をVU1レジスタにロード
        3. 法線ベクトル、頂点座標、ST値、色をロード
        4. 透視変換、光源計算、Q値などを計算して結果をVU1Memにストア
           その際、st値に設定されたオフセットを加える。
        5. 3. に戻り、頂点数回繰り返し
        6. ストアされたデータ(Gif Packet)をGSへXGKICK


