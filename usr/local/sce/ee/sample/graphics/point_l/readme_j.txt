[SCEI CONFIDENTIAL DOCUMENT]
"PlayStation 2" Programmer Tool Runtime Library  Release 2.0
　　　　　　　　　Copyright (C) 1999 by Sony Computer Entertainment Inc.
                                                   All Rights Reserved
点光源サンプル

<サンプルの解説>

	点光源処理をおこなうサンプルです．このサンプルでの光源は２つです．
        点光源は通常，距離の２乗に反比例して光の強さが減衰する光です．
        また，本サンプルでは見ための効果を考え，距離に反比例で減衰する
	パターンも用意しました．

<ファイル>

        main.c          :メインプログラム
        main.h          :メインプログラムのプロトタイプ宣言
        defines.h       :各種 .c ファイルで用いるプロトタイプ宣言
	vu1pack.c       :VU1処理用データパケット生成関数プログラム
	tex256.dsm      :テクスチャデータファイル
        cube.dsm        :オブジェクトデータ(立方体)
        torus.dsm       :オブジェクトデータ(トーラス)
	grid200.dsm     :オブジェクトデータ(平面 200polygon)
	grid1800.dsm    :オブジェクトデータ(凹凸平面 1800polygon)
	plight.dsm      :VU1マイクロコード転送用パケット
	pl.vsm          :VU1マイクロコード(距離に反比例)
	pl_opt.vsm      :VU1マイクロコード(最適化版)
	pl2.vsm         :VU1マイクロコード(距離の2乗に反比例)
	pl_opt2.vsm     :VU1マイクロコード(2乗最適化版)
	basic.vsm       :VU1マイクロコード(キューブ描画用)

<起動方法>

        % make          ：コンパイル
        % make run      ：実行

        コンパイル後、以下の方法でも実行可能
        % dsedb
        > run main.elf

<コントローラの操作方法>

        ↑↓    :       赤い光源操作(前後)
        ←→    :       赤い光源操作(左右)
        L1L2    :       赤い光源操作(上下)
        △×    :       青い光源操作(前後)
        □○    :       青い光源操作(左右)
        R1R2    :       青い光源操作(上下)
        SELECTボタン     :モデルの切替え（平面，凹凸面）
        STARTボタン      :光の強度の減衰関数(距離の１乗・２乗)切替え

<備考>

    計算手法の概略

	各頂点の色計算をする際，光源からベクトルを引き法線ベクトルとの
	内積を取って拡散反射光の強度を決定します．また光源からの距離も
	光の強度に影響します．計算式を簡単に示すと以下のようになります．

	Vertex_point(VP) : ポリゴン頂点座標
	Vertex_color(VC) : ポリゴン頂点色(色計算前)
	Vertex_normal(VN): ポリゴン頂点法線ベクトル
	Light_point(LP)  : 光源座標
	Light_color(LC)  : 光源色
	coef             : 係数
	・               : 内積
	*                : ベクトル各要素間の積

	距離に反比例して減衰
	  (RGB) = ( ((VP-LP)/|VP-LP|・VN * coef/|VP-LP|) * LC ) * VC
	      = coef/|VP-LP|^2 * ((VP-LP)・VN) * LC * VC
	
	距離の２乗に反比例して減衰
	  (RGB) = ( ((VP-LP)/|VP-LP|・VN * coef/|VP-LP|^2) * LC ) * VC
	      = coef/|VP-LP|^3 * ((VP-LP)・VN) * LC * VC

	実際には計算の各過程で，正規化などの処理が必要になりますので
	ご注意ください．	


    注意事項

	1.通常オブジェクトはローカル座標系で定義されます．逆に点光源座標
	はたいていワールド座標で定義します．VU1に伝送されるデータは
	「オブジェクト->ローカル座標」ですから，ワールド座標にある
	点光源との間でベクトルを取るわけにはいきません．

	これを回避する方法はいくつかあります．
	１つは，透視変換の過程でLocal->Screenの変換マトリクスを 
	Local->World,World->Screen の２段に分割し，途中でベクトルを
	とる方法です．ですがこの手法は，VU1マイクロコードに余計な
	計算処理を要しますのであまりお勧めしません．
	２つめは，点光源をあらかじめ World->Localに逆変換しておき，
	VU1にその点光源座標を伝える方法です．こちらはVU1への計算負荷
	を必要としません．本サンプルではこちらの手法を用いています．

	2.点光源による色計算は，各ポリゴン頂点単位でおこないます．
	光の強度は通常，距離(２乗)の逆数に比例する形になりますから，
	ポリゴン頂点間の色を線形補間(グーローシェーディング)した
	のでは，ピクセルレベルでの正確な色計算はできません．
	特にポリゴンが荒くなってくると，その傾向が顕著に現れる
	ようになります．
	したがって，点光源計算で一定のクオリティを保つには，
	ポリゴン解像度への気くばりが必要になりますのでご注意ください．
