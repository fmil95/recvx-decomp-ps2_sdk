[SCEI CONFIDENTIAL DOCUMENT]
"PlayStation 2" Programmer Tool Runtime Library  Release 2.0

                  Copyright (C) 1999 by Sony Computer Entertainment Inc.
                                                     All Rights Reserved


PSMCT32フォーマットによるテクスチャの高速転送


<サンプルの解説>

        GSにおいてテクスチャを利用する場合、メインメモリからフレームバッファ
        にテクスチャおよびそのCLUTを転送し、それを参照します。
        このとき、GSでのテクスチャ描画の高速化のため、メインメモリから
        GSへの転送の際に、あるルールに基づいたビット変換が自動的に行われ
        そのビット形式でGSのフレームバッファ上にストアされることになります。

        このため、PSMT4, PSMT8, PSMCT16のビットパターンのテクスチャの転送は
        同じデータサイズ（解像度ではない）であっても、PSMCT32のビットパターン
	転送よりも低速になります
        (doc/ee/word/tips/gsvpu.ppt:「テクスチャ転送」参照）。

        フレームバッファ上の描画するテクスチャを入れ替える等の処理を行う際、
        4/8bitのテクスチャについては、あらかじめそれをPSMCT32として転送可能な
	ビットパターンに変換して転送し、これをPSMT4/8として参照するという
	方法がパフォーマンス向上につながります。

        このサンプルでは、以下を示します。
        
        - PSMT4/8のテクスチャを、PSMCT32としてGSに転送できる形に変換する
	  オフラインビット変換サンプルプログラム。
        - PSMT4/8をそのまま転送する場合と、PSMCT32に変換して転送する場合との
	  パフォーマンスの比較。

        GSローカルメモリにおける各ビットパターンの詳細については、
        SCE-NETにあるドキュメント「GSローカルメモリの詳細」を参照してください。

<ファイル>
      bitconv/
        bitconvはPSMT4/8のraw-imageをPSMCT32で転送可能なビット配置に
        変換するオフラインサンプルプログラムです。linux上でPSMT4, PSMT8の
	raw-imageをPSMCT32で転送可能な形式に変換します。

        bitconv <ソース画像のビット数(4/8)> <入力画像の幅> <入力画像の高さ> 
		<入力画像> <出力画像>

        <制限事項>
        - テクスチャの幅、高さはそれぞれ２のべき乗である必要があります。
        - テクスチャページサイズよりも小さなテクスチャは正しく変換されない
	  場合があります。

      4bit/
        4bit, 256x256のテクスチャを32bit, 128x64のテクスチャとして転送する
	サンプルです。
        #define __32BIT__を立てることで、32bitに変換されたテクスチャを
	転送します。
        転送サイズは32768bytesで、これを100回転送してそのH-countを表示
	しています。

        TBP=6720に転送する場合、
        PSMT4   : 221
        PSMCT32 : 98
        と、PSMCT32の方が高速に転送可能です。
        またPSMT4の場合、TBPはページバウンダリ(16の倍数)以外に設定すると
        パフォーマンスが非常に悪くなります。

      8bit/
        8bit-256x256のテクスチャを、32bit-128x128のテクスチャとして転送する
	サンプルです。
        #define __32BIT__を立てることで、32bitに変換されたテクスチャを
	転送します。
        転送サイズは65536bytesで、これを100回転送してそのH-countを表示
	しています。

        TBP=6720に転送する場合、
        PSMT8   : 205
        PSMCT32 : 178
        と、PSMCT32の方が高速に転送可能です。
        またPSMT8の場合、TBPはページバウンダリ(16の倍数)以外に設定すると
        パフォーマンスが非常に悪くなります。

<起動方法>
	% make		：コンパイル
	% make run	：実行
	もしくは、以下の方法でも実行できます
	% dsedb
	> run main.elf

<コントローラの操作方法>
	なし

